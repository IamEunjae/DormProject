{% load static %}
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>라운지 예약(30분 슬롯)</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  <style>
    .grid{border-collapse:collapse;width:100%;max-width:960px}
    .grid th,.grid td{border:1px solid #ddd;padding:.6rem;text-align:center}
    .grid thead th{background:#f6f7fb}
    .cell-free{background:#e9f7ef}
    .cell-reserved{background:#fde2e2}
    .btn{padding:.35rem .7rem;border:1px solid #999;border-radius:6px;background:#fff;cursor:pointer}
    .btn.primary{background:#0d6efd;color:#fff;border-color:#0d6efd}
    .btn:disabled{background:#ccc;border-color:#ccc;color:#666;cursor:not-allowed}
    .names{width:12rem;padding:.35rem;border:1px solid #ccc;border-radius:6px}
  </style>
</head>
<body>
  {% if user.is_authenticated %}
    <p>안녕하세요, {{ user.name }}님 ({{ user.student_number }})</p>
    <form method="post" action="{% url 'login:logout' %}" style="display:inline;">
      {% csrf_token %}
      <button type="submit" class="btn">로그아웃</button>
    </form>
  {% endif %}

  <h1>기숙사 라운지 예약 (30분 슬롯)</h1>
  <p>일요일: 22:00~23:30 (3칸) / 월~목: 21:30~23:30 (4칸) / 금·토: 예약 불가</p>

  <form method="get" style="margin:.5rem 0">
    <input type="date" name="date" value="{{ date|date:'Y-m-d' }}">
    <button class="btn" type="submit">날짜 이동</button>
  </form>

  {% if no_slots %}
    <p><b>해당 요일은 예약할 수 없습니다. (금/토)</b></p>
  {% else %}
  <table class="grid">
    <thead>
      <tr>
        <th>시간</th>
        {% for lg in lounges %}<th>라운지 {{ lg.number }}</th>{% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for row in grid %}
        <tr>
          <td><b>{{ row.label }}</b></td>
          {% for cell in row.cells %}
            <td class="{% if cell.reserved %}cell-reserved{% else %}cell-free{% endif %}">
              {% if cell.reserved %}
                <div>{{ cell.by }}</div>
                <button class="btn" disabled>예약 불가</button>
              {% else %}
                <form method="post" action="{% url 'reservation:reserve_slot' cell.number cell.start_key %}">
                  {% csrf_token %}
                  <input name="names" class="names" placeholder="신청자 이름들(쉼표 구분)">
                  <button type="submit" class="btn primary" {% if cell.disabled %}disabled{% endif %}>예약</button>
                </form>
              {% endif %}
            </td>
          {% endfor %}
        </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
</body>
</html>
